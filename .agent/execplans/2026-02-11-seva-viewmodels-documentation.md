# Document seva/viewmodels in detail

This ExecPlan is a living document. The sections `Progress`, `Surprises & Discoveries`, `Decision Log`, and `Outcomes & Retrospective` must be kept up to date as work proceeds.

PLANS.md lives at `.agent/PLANS.md` from the repository root. This document must be maintained in accordance with that file.

## Purpose / Big Picture

ViewModels are the UI state and command layer. This plan documents each viewmodel so a new developer can understand what UI state it owns, which commands it exposes, and how it interacts with usecases. The documentation must keep ViewModels free of IO and business logic, aligning with MVVM boundaries.

Success is observable when:

- Every file in `seva/viewmodels` starts with a Google-style module docstring describing purpose, dependencies, and call contexts.
- Every class/function has a Google-style docstring with summary, parameters, returns, side effects, call-chain, usage scenarios, and error cases.
- Inline comments explain complex state transitions or UI command flows.
- `docs/classes_seva.md` and `docs/workflows_seva.md` describe viewmodel responsibilities and their usecase dependencies.

## Progress

- [x] (2026-02-03 16:40Z) Mapped all files in `seva/viewmodels` to bound views and usecase touchpoints by tracing `seva/app/main.py` and `seva/app/run_flow_presenter.py`.
- [x] (2026-02-03 16:40Z) Expanded module docstrings in all `seva/viewmodels/*.py` files with purpose, dependencies, and call contexts.
- [x] (2026-02-03 16:40Z) Added/expanded class/function docstrings (Google style) across all viewmodel modules, including call-chain and error behavior where applicable.
- [x] (2026-02-03 16:40Z) Added inline comments for complex projection/state transitions in `progress_vm.py` and compatibility-progress logic in `runs_vm.py`.
- [x] (2026-02-03 16:40Z) Updated `docs/classes_seva.md` and `docs/workflows_seva.md` with explicit viewmodel responsibilities, view bindings, and usecase dependencies.
- [x] (2026-02-03 16:42Z) Ran final consistency pass and validation command (`pytest -q`), then embedded evidence snippets in this plan.

## Surprises & Discoveries

- Observation: The documentation target files (`docs/classes_seva.md`, `docs/workflows_seva.md`) already had uncommitted local edits before this ExecPlan execution started.
  Evidence: `git status --short` initially returned:
    M docs/classes_seva.md
    M docs/workflows_seva.md

- Observation: Several viewmodel functions had generic autogenerated docstrings with incorrect `Raises` clauses (for example claiming `ValueError` where no exception is thrown), so they needed semantic rewrites rather than mechanical expansion.
  Evidence: Pre-edit examples in `seva/viewmodels/settings_vm.py` and `seva/viewmodels/status_format.py` included placeholder `Raises` text unrelated to function behavior.

## Decision Log

- Decision: Use Google-style docstrings for all files in `seva/viewmodels`.
  Rationale: User requirement and alignment with GUI subsystem documentation.
  Date/Author: 2026-02-11 / Agent

- Decision: Document internal helper methods as well (not only public APIs) to satisfy the "every class/function" requirement and keep the files self-explanatory for novice contributors.
  Rationale: Internal helpers in `progress_vm.py` and `experiment_vm.py` encode non-obvious UI transformations.
  Date/Author: 2026-02-03 / Agent

- Decision: Keep behavior unchanged and limit edits to docstrings/comments/docs text.
  Rationale: Scope of this ExecPlan is documentation, and behavior-preserving changes reduce regression risk.
  Date/Author: 2026-02-03 / Agent

## Outcomes & Retrospective

- Milestone outcome (in progress): Viewmodel documentation coverage is now complete at module/class/function level, and architecture call-chains are documented in `docs/classes_seva.md` and `docs/workflows_seva.md`.
- Milestone outcome (completed): Validation command passed (`8 passed`) and no behavior changes were introduced; edits remained documentation-only within target files.

## Context and Orientation

ViewModels coordinate UI state and commands. They should not perform IO or build API payloads. Instead, they invoke usecases or adapters via injected dependencies. Documenting these files clarifies which UI elements are bound to which state variables and which commands trigger workflows.

Key files (non-exhaustive):

- `seva/viewmodels/experiment_vm.py`
- `seva/viewmodels/plate_vm.py`
- `seva/viewmodels/progress_vm.py`
- `seva/viewmodels/runs_vm.py`
- `seva/viewmodels/settings_vm.py`
- `seva/viewmodels/live_data_vm.py`

## Plan of Work

1) Map each viewmodel to its UI views and usecases.
   - Identify which views bind to each viewmodel and which usecases they trigger.
   - Capture these relationships in `docs/classes_seva.md` and `docs/workflows_seva.md`.

2) Add module docstrings for each viewmodel file.
   - Explain UI state responsibilities, dependencies, and typical call contexts.

3) Add/expand class/function docstrings.
   - Include summary, parameters, returns, side effects, call-chain, usage scenarios, and error cases.
   - Explicitly mention which usecases are invoked and why.

4) Add inline comments for complex state updates.
   - Focus on derived state or multi-step UI updates.

5) Update documentation files.
   - Ensure viewmodel responsibilities and their relationships to views/usecases are described.

6) Final pass for consistency.

## Concrete Steps

All steps are run from the repository root (`/workspace/SEVA_GUI_MVVM`).

1) Inspect viewmodel files:

    sed -n '1,200p' seva/viewmodels/experiment_vm.py
    sed -n '1,200p' seva/viewmodels/plate_vm.py
    sed -n '1,200p' seva/viewmodels/progress_vm.py
    sed -n '1,200p' seva/viewmodels/runs_vm.py
    sed -n '1,200p' seva/viewmodels/settings_vm.py
    sed -n '1,200p' seva/viewmodels/live_data_vm.py
    sed -n '1,200p' seva/viewmodels/status_format.py

2) Add/expand docstrings and inline comments in each file.

3) Update `docs/classes_seva.md` and `docs/workflows_seva.md`.

4) Optional validation (documentation only):

    pytest -q

   Evidence captured during execution:

    PS C:\Users\LunaP\OneDrive - UBC\Dokumente\Chemistry\Potentiostats\GUI Testing\SEVA_GUI_MVVM> pytest -q
    ........                                                                 [100%]
    8 passed in 0.11s

## Validation and Acceptance

- All viewmodel files have Google-style module docstrings with call contexts.
- All classes/functions have Google-style docstrings with parameters, returns, side effects, call-chain, usage scenarios, and error cases.
- Inline comments clarify complex UI state logic.
- `docs/classes_seva.md` and `docs/workflows_seva.md` describe viewmodel responsibilities.

## Idempotence and Recovery

Documentation changes are safe and repeatable. Revert and reapply documentation-only changes with `git restore <file>` as needed.

## Artifacts and Notes

Expected artifacts:

- Updated docstrings and inline comments in `seva/viewmodels/*.py`.
- Updated `docs/classes_seva.md` and `docs/workflows_seva.md` sections for viewmodels.
- Validation transcript proving repository tests still pass after documentation edits.

## Interfaces and Dependencies

No new dependencies are introduced. Interfaces to highlight include:

- Usecases in `seva/usecases/*`
- Views in `seva/app/views/*`

---

Change note: Initial plan created to cover the viewmodel subsystem in deep detail.

Change note (2026-02-03 16:40Z): Updated living sections after completing mapping, docstring/comment updates, and docs call-chain updates; left final validation/evidence step open.
Change note (2026-02-03 16:42Z): Marked final milestone complete, added pytest evidence snippet, and updated retrospective to reflect completion.
